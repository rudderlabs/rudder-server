FROM golang:1.13-alpine AS builder
RUN apk add build-base make
ADD . /app
WORKDIR /app
RUN make build
FROM alpine:latest
RUN apk add --no-cache ca-certificates postgresql-client
COPY --from=builder /app/rudder-server /
RUN mkdir /app
ADD . /app
ADD build/wait-for /
ADD build/docker-entrypoint.sh /
ENTRYPOINT ["/docker-entrypoint.sh"]
CMD ["/rudder-server-with-race"]
